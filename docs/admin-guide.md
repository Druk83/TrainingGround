## Руководство по UI суперадминистратора

Эта страница описывает, как системный администратор взаимодействует с TrainingGround после авторизации под ролью `admin`.

### 1. Вход и проверка доступа
1. Выполните `npm run dev` / `scripts/dev.cmd` для запуска фронтенда и `cargo run` (или `scripts\api.cmd`) для backend.
2. Авторизуйтесь под учетной записью с ролью `admin`. Если используете тестовые данные, воспользуйтесь сидером `infra/config/seed/admin-superuser.json` либо интеграционными тестами `admin_*_tests.rs`.
3. После логина шапка (`<app-header>`) покажет разделы «Пользователи», «Группы», «Настройки», «Античит», «Аудит» и «Главная».

### 2. Dashboard (`/admin`)
- **Карточки метрик**: uptime, активные сессии, количество пользователей/групп.
- **Очереди и фичи**: блок «Шаблоны» отображает список последних шаблонов, очередь публикаций и флаги из API `/admin/system/metrics`.
- **Резервные копии**: нижний блок показывает `BackupRecord`-ы с кнопкой «Создать бэкап». После триггера `createBackup` таблица обновляется автоматически.

### 3. Управление пользователями (`/admin/users`)
- Фильтры: поиск по имени/email, фильтрация по роли и статусу блокировки.
- Действия из таблицы: редактирование профиля, блокировка, сброс пароля, удаление.
- Модальные окна используют санитайзер (`sanitizeInput`) для всех полей: имена, e‑mail, причины блокировки.

### 4. Управление группами (`/admin/groups`)
- Фильтры по названию школы и куратору.
- Создание/редактирование групп с назначением `teacher` как куратора.
- Экспорт CSV вызывает `/admin/groups/export` и скачивает файл.

### 5. Системные настройки (`/admin/settings`)
Каждая карточка (YandexGPT, SSO, Email, Anticheat) работает одинаково:
1. Форма подставляет сохраненные значения (или дефолты).
2. При нажатии «Сохранить» вызываются `updateYandexGptSettings` / `updateSsoSettings` / `updateEmailSettings` / `updateAnticheatSettings`.
3. Кнопки «Показать/скрыть» маскируют секреты (API key, client secret, SMTP пароль).
4. **Кнопки теста** отправляют запросы `/admin/settings/test/*` и показывают нотификацию о результате.

### 6. Античит-инциденты (`/admin/anticheat`)
- Таблица с фильтрами по типу, степени риска, статусу.
- Детальная панель справа визуализирует метрики ответа (histogram) и позволяет разблокировать пользователя.

### 7. Аудит-логи (`/admin/audit`)
- Фильтры по типу события, пользователю, диапазону дат.
- Просмотр деталей события, включая IP, user-agent, payload действия.

### 8. Резервные копии
- Раздел в dashboard, доступен только `admin`.
- `createBackup` сейчас сохраняет только метаданные (`backup_service.rs`), но API уже готово для расширения (например, интеграция с S3).

### 9. Проверка окружения
- **MongoDB**: `mongodb://admin:changeMe123@localhost:27017/...` — требуется для интеграционных тестов.
- **Redis**: `redis://:changeMeRedis@127.0.0.1:6379/0` — используется rate limiter-ом и сервисами очередей.
- **Rate limiting**: переменные `ADMIN_RATE_LIMIT_*` регулируют политику 429.

### 10. Советы по эксплуатации
- Интеграционные тесты (`cargo test --test admin_*`) создают и очищают данные автоматически, но требуют работающих Mongo/Redis.
- Если нужно отключить rate limit в локальной среде, задайте `RATE_LIMIT_DISABLED=true`.
- Для обновления UI после деплоя перерегистрируйте PWA (service worker) либо выполните hard refresh.
