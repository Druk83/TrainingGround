## Руководство администратора контента

### Общая роль
Администратор контента работает с шаблонами заданий, темами, уровнями и правилами русского языка. Использует `/admin` табы «Шаблоны», «Темы и уровни», «Правила», «Качество», «Эмбеддинги».

### Основные действия
- **Шаблоны** – фильтры, создание с параметрами (`slug`, `level_id`, `rule_ids`, `content`, `difficulty`, `source_refs`), модерация (переход `draft → pending_review → reviewed_once → ready`, публикация), история версий и поиск дубликатов.
- **Темы и уровни** – CRUD тем (`slug`, `name`, `description`, `status`), управление уровнями (создание/редактирование/деактивация), переупорядочивание уровней и просмотр реального покрытия.
- **Правила** – CRUD (название, категория, примеры, исключения, источники, статус) и оценка покрытия по шаблонам.
- **Качество** – запуск валидатора (`/templates/validate`), просмотр `TemplateValidationIssue` и списка `TemplateDuplicate`.
- **Эмбеддинги** – запуск `/embeddings/rebuild` с режимами, мониторинг `/progress` и проверка `/consistency`.

### Обогащение шаблонов
Таб «Обогащение» доступен в админской консоли для ролей `admin` и `content_admin`. Он позволяет генерировать и модерировать вариации заданий на основе опубликованных шаблонов:

1. **Выбор шаблона** – список показывает только опубликованные шаблоны. После выбора загружаются сохранённые параметры генерации, история запусков и текущий список задач.
2. **Настройка генерации** – укажите количество вариаций (1–200), при необходимости дневной лимит и флаг «Разрешить повтор ранее показанных задач». Кнопка «Запустить» сохраняет настройки в `metadata.generation_settings` и вызывает Template Generator.
3. **История запусков** – таблица отображает статус (`in_progress`, `completed`, `failed`), число успешных/ошибочных задач и применённые лимиты, чтобы понимать когда генерация завершилась или упала.
4. **Список задач** – выводит текст, ответ и дату создания. Для каждой записи доступны действия «Удалить» (помечает как `rejected`) и «Перегенерировать» (запрашивает новую формулировку только для выбранной строки). После проверки активные варианты автоматически попадают в банк и могут выдаваться ученикам.

Все действия обогащения пишутся в `audit_log`. Одновременно допускается только один запуск на шаблон; новые запросы делайте после завершения текущего прогона.

### UI советы
- Последовательность: создайте тему → добавьте уровень → создайте шаблон с правилами и отправьте на модерацию. Найдите дубликаты перед публикацией.
- Воспользуйтесь metric-дашбордом и очередь контента (`content:changes`) чтобы отследить обработку.

### Безопасность
- Только роли `admin` и `content_admin` могут пользоваться `/admin`.
- Все действия логируются в `audit_log`.
