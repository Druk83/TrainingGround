# Конфигурация окружения для TrainingGround
# Development: cp .env.example .env (localhost, тестовые пароли)
# Production: cp .env.example .env (strong passwords, vault DNS names)

# Docker Compose профили (monitoring включает Prometheus, Grafana, Jaeger, Exporters)
# Оставьте пустым для основных сервисов, используйте "monitoring" для полного стека
COMPOSE_PROFILES=monitoring

# Окружение (development, test, staging, production)
NODE_ENV=development

# MongoDB Replica Set (3 узла для Change Streams)
MONGO_USER=admin
MONGO_PASSWORD=<YOUR_MONGO_PASSWORD>
MONGO_DB=trainingground
# Подключение к replica set (все 3 ноды)
MONGODB_URI=mongodb://admin:<YOUR_MONGO_PASSWORD>@localhost:27017,localhost:27018,localhost:27019/trainingground?authSource=admin&replicaSet=rs0
MONGODB_DATABASE=trainingground
# MongoDB keyfile for replica set authentication (generate with: scripts/generate_mongo_keyfile.ps1)
MONGO_KEYFILE_PATH=./infra/mongo-keyfile.secure

# Redis (кеш и сессии)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=<YOUR_REDIS_PASSWORD>

CONTENT_STREAM_NAME=content:changes

# Qdrant (векторная БД)
QDRANT_URL=http://localhost:6333
QDRANT_API_KEY=<YOUR_QDRANT_API_KEY>

# Rust API (основной API)
APP_ENV=dev
RUST_LOG=info
RUST_API_PORT=8080
RUST_API_HOST=0.0.0.0

# JWT Authentication
JWT_SECRET=<YOUR_JWT_SECRET_GENERATE_WITH_openssl_rand_base64_32>
JWT_FALLBACK_SECRETS=
JWT_ACCESS_TOKEN_TTL_SECONDS=3600
JWT_REFRESH_TOKEN_TTL_SECONDS=2592000

# Cookie Security
COOKIE_SECURE=true
COOKIE_SAME_SITE=Strict
CSRF_ALLOWED_ORIGINS=http://localhost:8081,http://localhost:4173

# Rate Limiting (защита от brute force)
RATE_LIMIT_DISABLED=false
RATE_LIMIT_PER_USER=100
RATE_LIMIT_PER_IP=200
RATE_LIMIT_LOGIN_ATTEMPTS=10
RATE_LIMIT_REGISTER_ATTEMPTS=5

# HashiCorp Vault (управление секретами и ключами шифрования)
VAULT_ADDR=http://localhost:8200
VAULT_ROOT_TOKEN=<YOUR_VAULT_ROOT_TOKEN>
# AppRole credentials для приложения (получить после запуска init-mongodb-encryption.sh)
VAULT_ROLE_ID=<YOUR_VAULT_ROLE_ID>
VAULT_SECRET_ID=<YOUR_VAULT_SECRET_ID>

# MongoDB Encryption at Rest (CSFLE - Client-Side Field Level Encryption)
MONGODB_ENCRYPTION_ENABLED=false
MONGODB_ENCRYPTION_PROVIDER=vault
# Для dev/testing можно использовать local provider (НЕ БЕЗОПАСНО для production!)
MONGODB_ENCRYPTION_LOCAL_MODE=false

# Python Generator (генератор заданий / Explanation API)
PYTHON_API_PORT=9000
YANDEXGPT_API_KEY=<YOUR_YANDEXGPT_API_KEY>
YANDEXGPT_FOLDER_ID=<YOUR_YANDEX_FOLDER_ID>
YANDEXGPT_MODEL=yandexgpt-lite
YANDEXGPT_TEMPERATURE=0.2
YANDEXGPT_MAX_TOKENS=700
YANDEXGPT_TIMEOUT_SECONDS=2.0
# Опционально: переопределить системный промпт
# YANDEXGPT_SYSTEM_PROMPT=Ты — преподаватель русского языка. Объясняй ошибки кратко, с примерами и отсылками к правилам.
EXPLANATION_YANDEXGPT_ENABLED=1

# Frontend (PWA)
VITE_API_URL=http://localhost:8080
VITE_WS_URL=ws://localhost:8080
VITE_BACKEND_ORIGIN=http://localhost:8081
VITE_API_BASE=http://localhost:8081/api/v1
VITE_ADMIN_BASE=http://localhost:8081/admin

# Логирование
LOG_LEVEL=info

# Feature Flags (для разработки)
ENABLE_SSO=false
ENABLE_YANDEX_GPT=true
ENABLE_ANTICHEAT=true

# Античит-оповещения
ANTICHEAT_TELEGRAM_BOT_TOKEN=
ANTICHEAT_TELEGRAM_CHAT_ID=
ANTICHEAT_INCIDENT_WEBHOOK_URL=

# Alertmanager webhook/Telegram
ALERTMANAGER_TELEGRAM_BOT_TOKEN=
ALERTMANAGER_TELEGRAM_CHAT_ID=
ALERTMANAGER_WEBHOOK_URL=

# Object Storage (report exports)
OBJECT_STORAGE_BUCKET=<YOUR_BUCKET_NAME>
OBJECT_STORAGE_REGION=ru-central1
OBJECT_STORAGE_ENDPOINT=<YOUR_ENDPOINT_URL>
OBJECT_STORAGE_ACCESS_KEY=<YOUR_ACCESS_KEY>
OBJECT_STORAGE_SECRET_KEY=<YOUR_SECRET_KEY>
OBJECT_STORAGE_REPORTS_PREFIX=reports/dev

# Reporting defaults
REPORTING_SIGNED_URL_TTL_HOURS=24
REPORTING_EXPORT_TTL_HOURS=24
REPORTING_EXPORT_RATE_LIMIT_PER_HOUR=5
REPORTING_LIVE_POLLING_INTERVAL_SECS=30
REPORTING_ENABLE_LIVE_UPDATES=true
REPORTING_EXPORT_WORKER_INTERVAL_SECS=60
REPORTING_WORKER_INTERVAL_SECS=3600

# Пароль администратора Grafana
GRAFANA_PASSWORD=<YOUR_GRAFANA_PASSWORD>

# Metrics endpoint authentication (format: username:password)
# Used for HTTP Basic Auth on /metrics endpoint
METRICS_AUTH=prometheus:<YOUR_METRICS_PASSWORD>

# Superuser bootstrap seed file (keep this path outside git, file ignored via .gitignore)
ADMIN_SEED_FILE=infra/config/seed/admin-superuser.json
