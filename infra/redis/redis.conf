# Redis Configuration for TrainingGround
# Production-ready settings

## Network
bind 0.0.0.0
port 6379
protected-mode yes
requirepass ${REDIS_PASSWORD}

## Persistence (Hybrid RDB + AOF)
save 900 1      # Save after 15 min if 1 key changed
save 300 10     # Save after 5 min if 10 keys changed
save 60 10000   # Save after 1 min if 10000 keys changed

appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

## Memory Management
maxmemory 2gb
maxmemory-policy allkeys-lru
maxmemory-samples 5

## Performance
timeout 300
tcp-keepalive 300
tcp-backlog 511

## Logging
loglevel notice
logfile /var/log/redis/redis-server.log

## Slow Log
slowlog-log-slower-than 10000
slowlog-max-len 128

## Client Output Buffer Limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

## Advanced
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes

## Security
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG "CONFIG_${REDIS_ADMIN_SECRET}"
