–ù–∏–∂–µ ‚Äî **—Ä–∞–∑–±–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ —Ç—Ä—ë—Ö —Ç–µ–∫—Å—Ç–æ–≤-–æ—Ç–≤–µ—Ç–æ–≤** (–Ω–∞—Å–∫–æ–ª—å–∫–æ –æ–Ω–∏ —Ä–µ–∞–ª—å–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –≤–∞—à–∏–º compose-—Ñ–∞–π–ª–∞–º) –∏ **–º–æ—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è –∫—Ä–∏—Ç–∏–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ Docker-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π**.

## 1) –ö—Ä–∏—Ç–∏–∫–∞ —Ç—Ä—ë—Ö –æ—Ç–≤–µ—Ç–æ–≤ (—Ç–æ—á–Ω–æ—Å—Ç—å vs —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å)

### –¢–µ–∫—Å—Ç ‚Ññ1

**–°–∏–ª—å–Ω—ã–µ –º–µ—Å—Ç–∞ (–ø–æ–ø–∞–ª –≤ —Ñ–∞–∫—Ç—É—Ä—É):**

* –í–µ—Ä–Ω–æ —É–≤–∏–¥–µ–ª **–∫–æ–ø–∏–ø–∞—Å—Ç—É Mongo ReplicaSet** (3 –ø–æ—á—Ç–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–∞) ‚Äî —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ç–∞–∫ –≤ dev –∏ –≤ prod.  
* –í–µ—Ä–Ω–æ –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ **Vault –≤ dev –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ `server -dev`**. 
* –í–µ—Ä–Ω–æ –æ—Ç–º–µ—Ç–∏–ª –ø—Ä–æ–±–ª–µ–º—É, —á—Ç–æ **Redis –ø–∞—Ä–æ–ª—å –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ `--requirepass`** (–æ–Ω –±—É–¥–µ—Ç —Å–≤–µ—Ç–∏—Ç—å—Å—è –≤ `docker inspect` –∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–ø—É—Å–∫–∞). –≠—Ç–æ –µ—Å—Ç—å –∏ –≤ dev, –∏ –≤ prod.  
* –í–µ—Ä–Ω–æ —Ç–∫–Ω—É–ª –≤ —Ç–æ, —á—Ç–æ **–≤ prod –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-—Å–µ—Ä–≤–∏—Å—ã –ø—É–±–ª–∏–∫—É—é—Ç –ø–æ—Ä—Ç—ã –Ω–∞—Ä—É–∂—É** (Grafana/Loki/Alertmanager; Prometheus —Ç–æ–∂–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è). 

**–û—à–∏–±–∫–∏/–Ω–∞—Ç—è–∂–∫–∏ (–∫–∞–∫ –º–∏–Ω–∏–º—É–º –Ω–µ –¥–æ–∫–∞–∑–∞–Ω–æ –≤–∞—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏):**

* –§—Ä–∞–∑–∞ ‚ÄúVault –≤ dev-—Ä–µ–∂–∏–º–µ –¥–∞–∂–µ –≤ prod‚Äù ‚Äî **–ø–æ –≤–∞—à–∏–º —Ñ–∞–π–ª–∞–º –Ω–µ —Ç–∞–∫**: –≤ prod Vault –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `command: server` –∏ —Å `VAULT_LOCAL_CONFIG` (—Ö–æ—Ç—è —Ç–∞–º –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏). 
* –ó–∞—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ ‚Äú–Ω–µ—Ç .dockerignore‚Äù, ‚Äú–ø—Ä–æ–±–ª–µ–º—ã Rust/Python Dockerfile‚Äù ‚Äî **–Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã —Ç–µ–º–∏ –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ compose, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –¥–∞–ª–∏** (—ç—Ç–æ —É–∂–µ —É—Ä–æ–≤–µ–Ω—å Dockerfile‚Äô–æ–≤/–∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ —Å–±–æ—Ä–∫–∏, –∞ –≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞—Ö —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è). 

**–ò—Ç–æ–≥:** –ø–æ compose-—Ñ–∞–π–ª–∞–º ‚Äî **—Å–∏–ª—å–Ω—ã–π** (–º–Ω–æ–≥–æ —Ç–æ—á–Ω—ã—Ö –ø–æ–ø–∞–¥–∞–Ω–∏–π), –Ω–æ –µ—Å—Ç—å **1‚Äì2 —Å–µ—Ä—å—ë–∑–Ω—ã—Ö –Ω–µ–≤–µ—Ä–Ω—ã—Ö —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è** –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–ø—Ä–æ–≤–µ—Ä—è–µ–º—ã—Ö.

---

### –¢–µ–∫—Å—Ç ‚Ññ2

**–°–∏–ª—å–Ω—ã–µ –º–µ—Å—Ç–∞:**

* –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–≤–∏–¥–µ–ª **–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ dev/prod compose** –∏ —Ä–∏—Å–∫ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.  
* –í —Ü–µ–ª–æ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–¥–º–µ—á–∞–µ—Ç, —á—Ç–æ –±–∞–∑–æ–≤—ã–π `docker-compose.yml` –ø–æ–¥–Ω–∏–º–∞–µ—Ç ‚Äú–ø–æ—á—Ç–∏ –ø—Ä–æ–¥–æ–≤—ã–π‚Äù —Å—Ç–µ–∫ (Mongo RS + Redis + Qdrant + Vault + –¥–≤–∞ backend‚Äô–∞) ‚Äî –¥–∞–∂–µ –±–µ–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.   

**–°–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ / —Å–æ–º–Ω–∏—Ç–µ–ª—å–Ω–æ–µ:**

* –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ ‚Äú.env.example –∑–∞–¥–∞—ë—Ç COMPOSE_PROFILES=monitoring‚Äù ‚Äî **–≤ –≤–∞—à–∏—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö —ç—Ç–æ–≥–æ –Ω–µ—Ç**, –ø–æ—ç—Ç–æ–º—É –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –¥–æ–ø—É—â–µ–Ω–∏–µ/–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è. 
* –î–∞–ª—å—à–µ –æ–Ω –¥–µ–ª–∞–µ—Ç –≤—ã–≤–æ–¥—ã –∏–∑ —ç—Ç–æ–≥–æ (—á—Ç–æ `make up` –≤—Å–µ–≥–¥–∞ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥), –∞ –ø–æ compose –≤–∏–¥–Ω–æ, —á—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏–¥–∏—Ç –≤ `profiles: ["monitoring"]` –∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç. 

**–ò—Ç–æ–≥:** —Ö–æ—Ä–æ—à–∏–π –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ, –Ω–æ **–µ—Å—Ç—å –∫–ª—é—á–µ–≤–∞—è ‚Äú–æ–ø–æ—Ä–∞‚Äù –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π (–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö) —Ñ–∞–∫—Ç**.

---

### –¢–µ–∫—Å—Ç ‚Ññ3

**–ü—Ä–æ–±–ª–µ–º–∞:** –æ–Ω –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ ‚Äú—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∫—Ä–∏—Ç–∏–∫–∞ Docker –≤–æ–æ–±—â–µ‚Äù, –Ω–æ **—á–∞—Å—Ç—å —Ç–µ–∑–∏—Å–æ–≤ –ø—Ä—è–º–æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –≤–∞—à–∏–º compose**.

–ü—Ä–∏–º–µ—Ä—ã:

* ‚ÄúPython –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–æ–Ω—Ç–∏—Ç –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –≤ production‚Äù ‚Äî –≤ prod compose **—Ç–æ–º–æ–≤ –Ω–∞ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –Ω–µ—Ç**, —Ç–æ–ª—å–∫–æ env/—Å–µ—Ç–∏/—Ä–µ—Å—É—Ä—Å—ã. 
* ‚Äú–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç resource limits‚Äù ‚Äî –≤ prod compose –æ–Ω–∏ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã —á–µ—Ä–µ–∑ `deploy.resources`, —Ö–æ—Ç—å –∏ –µ—Å—Ç—å –Ω—é–∞–Ω—Å –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ (–Ω–∏–∂–µ –ø–æ—è—Å–Ω—é). 
* ‚Äú–ù–µ—Ç .dockerignore —Ñ–∞–π–ª–æ–≤‚Äù ‚Äî –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —ç—Ç–æ **–Ω–µ –¥–æ–∫–∞–∑–∞–Ω–æ**, –∏ –∫–∞–∫ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–≤—É—á–∏—Ç –≥–æ–ª–æ—Å–ª–æ–≤–Ω–æ. 

**–ò—Ç–æ–≥:** –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞—à–∏—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤ ‚Äî **—Å–∞–º—ã–π —Å–ª–∞–±—ã–π**: —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–Ω—ã—Ö –∏/–∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã—Ö —Ç–µ–∑–∏—Å–æ–≤.

---

## 2) –ú–æ—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è –∫—Ä–∏—Ç–∏–∫–∞ Docker-–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–ø–æ –≤–∞—à–∏–º —Ñ–∞–π–ª–∞–º)

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (–º–æ–∂–µ—Ç –ª–æ–º–∞—Ç—å –∑–∞–ø—É—Å–∫ / –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

1. **Mongo keyfile –≤ prod —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω `:ro`, –Ω–æ –≤—ã –¥–µ–ª–∞–µ—Ç–µ `chmod/chown` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**
   –≠—Ç–æ –ø–æ—á—Ç–∏ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ —Å–ª–æ–º–∞–µ—Ç —Å—Ç–∞—Ä—Ç (–Ω–∞ read-only bind mount –ø—Ä–∞–≤–∞/–≤–ª–∞–¥–µ–ª—å—Ü–∞ –Ω–µ –ø–æ–º–µ–Ω—è—Ç—å). 
   –ß—Ç–æ –ª—É—á—à–µ:

* –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å keyfile –∫–∞–∫ secret/ro-–∏—Å—Ç–æ—á–Ω–∏–∫ –∏ **–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å** –µ–≥–æ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ writable –ø—É—Ç—å (—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏) –≤ entrypoint-—Å–∫—Ä–∏–ø—Ç–µ;
* –ª–∏–±–æ —Ö—Ä–∞–Ω–∏—Ç—å keyfile –≤ docker volume, –∞ –Ω–µ –≤ bind mount.

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ prod ‚Äú—Ç–æ—Ä—á–∏—Ç –Ω–∞—Ä—É–∂—É‚Äù –±–µ–∑ –∑–∞—â–∏—Ç–Ω–æ–≥–æ —Å–ª–æ—è**
   Grafana (3000), Loki (3100), Alertmanager (9093) –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç. 
   –ï—Å–ª–∏ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–π production ‚Äî –º–∏–Ω–∏–º—É–º:

* –±–∏–Ω–¥–∏–Ω–≥ –Ω–∞ `127.0.0.1:PORT:PORT` + –¥–æ—Å—Ç—É–ø –ø–æ VPN/SSH-tunnel, **–∏–ª–∏**
* –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Nginx —Å auth/ACL, **–∏–ª–∏**
* –≤–æ–æ–±—â–µ —É–±—Ä–∞—Ç—å `ports:` –∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ internal network.

3. **–°–µ–∫—Ä–µ—Ç—ã –≤ env/URI + Redis –ø–∞—Ä–æ–ª—å –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ**
   –í dev/prod –ø–∞—Ä–æ–ª–∏/—Ç–æ–∫–µ–Ω—ã –ø—Ä–æ–∫–∏–¥—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ env –∏ –ø—Ä—è–º–æ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.  
   –≠—Ç–æ –Ω–µ ‚Äú–∫–æ–Ω–µ—Ü —Å–≤–µ—Ç–∞‚Äù –¥–ª—è dev, –Ω–æ –¥–ª—è prod –ª—É—á—à–µ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ file-based secrets (Docker secrets/volume-mounted —Ñ–∞–π–ª—ã) –∏–ª–∏ —Ö–æ—Ç—è –±—ã –ø–æ–¥–¥–µ—Ä–∂–∫—É `*_FILE`.

---

### üü° –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å)

4. **–û–≥—Ä–æ–º–Ω–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É `docker-compose.yml` –∏ `docker-compose.prod.yml`**
   –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã/–±–ª–æ–∫–∏ (Mongo/Redis/Qdrant/Vault/Rust/Python) –æ–ø–∏—Å–∞–Ω—ã –¥–≤–∞–∂–¥—ã.  
   –õ—É—á—à–µ —Å–¥–µ–ª–∞—Ç—å:

* `docker-compose.base.yml` (–æ–±—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã)
* `docker-compose.dev.yml` (ports, bind mounts, dev-mode)
* `docker-compose.prod.yml` (nginx/https, –∑–∞–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã, prod env)
  –ò –∑–∞–ø—É—Å–∫–∞—Ç—å —á–µ—Ä–µ–∑ `docker compose -f base -f prod up -d`.

5. **–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ env-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ–∂–¥—É dev –∏ prod –¥–ª—è python-generator**
   –í dev: `MONGODB_URI`, `YANDEXGPT_*`‚Ä¶ 
   –í prod: `MONGO_URI`, `YANDEX_GPT_*`‚Ä¶ 
   –≠—Ç–æ —Ç–∏–ø–∏—á–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ ‚Äú–≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ dev, –∞ –≤ prod ‚Äî –Ω–µ—Ç‚Äù. –ù—É–∂–Ω–æ **—É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**.

6. **`deploy.resources` –≤ prod –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–∞–∫, –∫–∞–∫ –≤—ã –æ–∂–∏–¥–∞–µ—Ç–µ**
   –í –æ–±—ã—á–Ω–æ–º `docker compose up` (–Ω–µ swarm) –±–ª–æ–∫ `deploy:` —á–∞—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è. 
   –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã –≤ Compose ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤–∞—à–∏–º —Ä–∞–Ω—Ç–∞–π–º–æ–º –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã/–∑–∞–ø—É—Å–∫ —Å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é.

7. **`container_name` –≤–µ–∑–¥–µ**
   –≠—Ç–æ:

* –ª–æ–º–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–Ω—è—Ç—å –¥–≤–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ,
* –º–µ—à–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é —Å–µ—Ä–≤–∏—Å–æ–≤,
* –ø–æ–≤—ã—à–∞–µ—Ç —à–∞–Ω—Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.
  –ü–ª—é—Å —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç: **dev –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 27018 –ø–æ–¥ secondary1, –∞ test —Ç–æ–∂–µ 27018 –ø–æ–¥ mongodb-test** ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ dev+test –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.  
  –†–µ—à–µ–Ω–∏–µ: —É–±—Ä–∞—Ç—å `container_name`, –∏/–∏–ª–∏ —Ä–∞–∑–≤–æ–¥–∏—Ç—å –ø—Ä–æ–µ–∫—Ç–Ω—ã–µ –∏–º–µ–Ω–∞/–ø–æ—Ä—Ç—ã, –∏/–∏–ª–∏ –Ω–µ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–æ—Ä—Ç—ã –Ω–∞—Ä—É–∂—É.

---

### üü¢ –ù–µ–ø–ª–æ—Ö–æ —Å–¥–µ–ª–∞–Ω–æ (—á—Ç–æ —É–∂–µ —Ö–æ—Ä–æ—à–æ)

* –í dev –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–Ω–µ—Å–µ–Ω –≤ `profiles: ["monitoring"]` ‚Äî —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, –Ω–µ –≤—Å—ë –≥—Ä—É–∑–∏—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. 
* –ï—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π `docker-compose.test.yml` —Å `tmpfs` ‚Äî —Ö–æ—Ä–æ—à–∏–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤. 
* –ï—Å—Ç—å healthcheck‚Äô–∏ –∏ `depends_on` —Å —É—Å–ª–æ–≤–∏—è–º–∏ –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö —Å–≤—è–∑–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, Rust API –∂–¥—ë—Ç Mongo). 

---

## –ï—Å–ª–∏ –∫–æ—Ä–æ—Ç–∫–æ: —á—Ç–æ –±—ã —è –∏—Å–ø—Ä–∞–≤–∏–ª –ø–µ—Ä–≤—ã–º

1. **Mongo keyfile –≤ prod:ro + chmod/chown** (–ø–æ—á–∏–Ω–∏—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª–æ). 
2. **–ó–∞–∫—Ä—ã—Ç—å –Ω–∞—Ä—É–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ prod** –∏–ª–∏ —Å–ø—Ä—è—Ç–∞—Ç—å –∑–∞ Nginx/VPN. 
3. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å env-–∫–æ–Ω—Ç—Ä–∞–∫—Ç python-generator dev vs prod**.  
4. **–°–Ω–∏–∑–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ compose-—Ñ–∞–π–ª–æ–≤** —á–µ—Ä–µ–∑ base+override. 
5. **–£–±—Ä–∞—Ç—å `container_name` –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤ dev/test**.  

---
–î–∞, —ç—Ç–æ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å –∫—Ä–∏—Ç–∏–∫–∏ Docker-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π**: *–∫–∞–∫ –±—ã—Å—Ç—Ä–æ —Å–æ–±–∏—Ä–∞—Ç—å*, *–∫–∞–∫ –∂–∏—Ç—å –≤ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ*, *–∫–∞–∫ –Ω–µ —É–±–∏–≤–∞—Ç—å –¥–∏—Å–∫ –æ–±—Ä–∞–∑–∞–º–∏/–∫—ç—à–µ–º*, –∏ *–∫–∞–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ –ø–æ–¥–Ω–∏–º–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏*.

–ù–∏–∂–µ ‚Äî —á—Ç–æ —è –±—ã –∑–∞–ª–æ–∂–∏–ª –≤ –¥–∏–∑–∞–π–Ω –∏–º–µ–Ω–Ω–æ –ø–æ–¥ –≤–∞—à–∏ —Ç–µ–∫—É—â–∏–µ compose-–ø–∞—Ç—Ç–µ—Ä–Ω—ã.

---

## 1) ‚Äú–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏‚Äù vs ‚Äú–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞‚Äù

–í–∞–∂–Ω–æ —Ä–∞–∑–¥–µ–ª—è—Ç—å:

* **–ó–∞–ø—É—Å–∫**: —É –≤–∞—Å —ç—Ç–æ —É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ —Å–¥–µ–ª–∞–Ω–æ —á–µ—Ä–µ–∑ `depends_on + healthcheck` (–Ω–∞–ø—Ä–∏–º–µ—Ä rust-api –∂–¥—ë—Ç mongo/redis). 
* **–°–±–æ—Ä–∫–∞**: `depends_on` *–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç* –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ‚Äúbuild order‚Äù. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ ‚Äî —Å–æ–±–∏—Ä–∞–π—Ç–µ —è–≤–Ω–æ –Ω—É–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å:

  ```bash
  docker compose build rust-api
  docker compose up -d rust-api
  ```

  –∏–ª–∏ –¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ Makefile-—Ç–∞—Ä–≥–µ—Ç–∞–º–∏.

---

## 2) –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π ‚Äúdev-—Ä–µ–∂–∏–º‚Äù –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤)

–°–µ–π—á–∞—Å —É –≤–∞—Å –∞—Å–∏–º–º–µ—Ç—Ä–∏—è:

* `python-generator` —É–∂–µ –º–æ–Ω—Ç–∏—Ç –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –∫–∞–∫ volumes. 
* `rust-api` **–Ω–µ** –º–æ–Ω—Ç–∏—Ç –∫–æ–¥ ‚Äî –∑–Ω–∞—á–∏—Ç –ª—é–±–∞—è –ø—Ä–∞–≤–∫–∞ = rebuild –æ–±—Ä–∞–∑–∞. 

### –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å

**–ò–¥–µ—è:** –¥–æ–±–∞–≤–∏—Ç—å *dev override* (`docker-compose.dev.yml`) –∏/–∏–ª–∏ `profiles: ["dev"]` –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤, –≥–¥–µ –Ω—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π —Ü–∏–∫–ª.

–ü—Ä–∏–º–µ—Ä (—Å—É—Ç—å, –Ω–µ –ø–æ–ª–Ω—ã–π —Ñ–∞–π–ª):

```yaml
services:
  rust-api:
    profiles: ["dev"]
    environment:
      APP_ENV: dev
    volumes:
      - ./backend/rust-api:/app
      - cargo-registry:/usr/local/cargo/registry
      - cargo-target:/app/target
    command: sh -lc "cargo install cargo-watch || true && cargo watch -x run"

volumes:
  cargo-registry:
  cargo-target:
```

–≠—Ñ—Ñ–µ–∫—Ç: **–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ ‚Üí –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞ –Ω–µ—Ç**, –∏–¥—ë—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

–î–ª—è Python ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω–æ —á—Ç–æ–±—ã –∫–æ–º–∞–Ω–¥–∞ –±—ã–ª–∞ —Å reload (–µ—Å–ª–∏ —ç—Ç–æ API):

```yaml
python-generator:
  profiles: ["dev"]
  volumes:
    - ./backend/python-generator/src:/app/src
  command: sh -lc "uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload"
```

---

## 3) Dockerfile –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ‚Äú–∑–∞—Ç–æ—á–µ–Ω‚Äù –ø–æ–¥ –º–µ–ª–∫–∏–µ –ø—Ä–∞–≤–∫–∏ (–∫—ç—à —Å–ª–æ—ë–≤ + BuildKit cache)

–ß—Ç–æ–±—ã ‚Äú–ø–æ–ø—Ä–∞–≤–∏–ª –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É ‚Üí –Ω–µ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏‚Äù, —Å–ª–æ–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–∞–∫–∏–º–∏:

### Rust

–õ—É—á—à–∏–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω:

* –æ—Ç–¥–µ–ª—å–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`Cargo.toml/Cargo.lock`)
* –æ—Ç–¥–µ–ª—å–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å `target/` –∏ registry —á–µ—Ä–µ–∑ BuildKit

–° BuildKit —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫ (–∏–¥–µ—è):

```dockerfile
# syntax=docker/dockerfile:1.6
RUN --mount=type=cache,target=/usr/local/cargo/registry \
    --mount=type=cache,target=/app/target \
    cargo build --release
```

### Python

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ:

* —Å–Ω–∞—á–∞–ª–∞ `pyproject.toml/requirements.txt`
* `pip install`
* –ø–æ—Ç–æ–º —Ç–æ–ª—å–∫–æ `COPY src`

–ò cache mount:

```dockerfile
RUN --mount=type=cache,target=/root/.cache/pip pip install -r requirements.txt
```

**–í–∞–∂–Ω–æ:** —É –≤–∞—Å –≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º `Dockerfile` –µ—Å—Ç—å –±—É–∫–≤–∞–ª—å–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏ `...` ‚Äî –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ ‚Äú–º–∞—Å–∫–∏—Ä–æ–≤–∫–∞‚Äù, —Ç–æ —Ç–∞–∫–æ–π Dockerfile –ø—Ä–æ—Å—Ç–æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω –∏ –∫—ç—à-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–∞–º –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞. 

---

## 4) ‚Äú–í–∫–ª—é—á–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏‚Äù ‚Äî –Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: dev-–æ–±—Ä–∞–∑ –∂–∏—Ä–Ω—ã–π, prod-–æ–±—Ä–∞–∑ —Ç–æ–Ω–∫–∏–π

–ü—Ä–∞–≤–∏–ª–æ:

* **dev stage**: –¥–æ–±–∞–≤–ª—è–π—Ç–µ –≤—Å—ë –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏/–ª–∏–Ω—Ç–∏–Ω–≥–∞/–º–∏–≥—Ä–∞—Ü–∏–π (curl, jq, bash, ca-certificates, watch-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã).
* **runtime stage**: —Ç–æ–ª—å–∫–æ –±–∏–Ω–∞—Ä–Ω–∏–∫/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ª–∏–±—ã.

–¢–∞–∫ –≤—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

* —É—Å–∫–æ—Ä—è–µ—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É
* –Ω–µ —Ç–∞—â–∏—Ç–µ –ª–∏—à–Ω–µ–µ –≤ production (–º–µ–Ω—å—à–µ CVE/—Ä–∞–∑–º–µ—Ä)

---

## 5) –ß—Ç–æ–±—ã –æ–±—Ä–∞–∑—ã –Ω–µ –º–Ω–æ–∂–∏–ª–∏—Å—å –∏ –Ω–µ –∑–∞—Å–æ—Ä—è–ª–∏ –¥–∏—Å–∫ ‚Äî —ç—Ç–æ –Ω—É–∂–Ω–æ ‚Äú–≤—Å—Ç—Ä–æ–∏—Ç—å –≤ –ø—Ä–æ—Ü–µ—Å—Å‚Äù

–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ–∞–ª—å–Ω–∞—è: –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö `build` –æ—Å—Ç–∞—é—Ç—Å—è:

* dangling images
* build cache
* –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ volume‚Äô—ã

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –∫–æ–º–∞–Ω–¥, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç –æ—Ñ–æ—Ä–º–∏—Ç—å –≤ Makefile

**1) –ë—ã—Å—Ç—Ä–æ —É–±—Ä–∞—Ç—å ‚Äú–º—É—Å–æ—Ä–Ω—ã–µ‚Äù –æ–±—Ä–∞–∑—ã (dangling):**

```bash
docker image prune -f
```

**2) –ß–∏—Å—Ç–∫–∞ –±–∏–ª–¥-–∫—ç—à–∞ (—Å–∞–º–æ–µ –ø—Ä–æ–∂–æ—Ä–ª–∏–≤–æ–µ):**

```bash
docker builder prune -f
```

**3) –ü–æ–ª–Ω–∞—è —É–±–æ—Ä–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ):**

```bash
docker system prune -af
```

**4) –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (—É–¥–æ–±–Ω–æ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤):**

```bash
docker compose down --remove-orphans --rmi local
```

–Ø –±—ã –¥–æ–±–∞–≤–∏–ª —ç—Ç–æ –∫–∞–∫ —Ü–µ–ª–∏ `make docker-prune`, `make docker-clean`, `make docker-reset` –∏ –ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ.

---

## 6) –ü—Ä–∞–∫—Ç–∏—á–Ω—ã–π ‚Äú—Ä–∏—Ç–º‚Äù —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å –≤—Å—ë

* –ú–µ–Ω—è—é –∫–æ–¥ —Å–µ—Ä–≤–∏—Å–∞ ‚Üí **–Ω–µ –±–∏–ª–¥–∏—Ç—å**, –∞ **bind mount + watch/reload** (dev override).
* –ú–µ–Ω—è—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`Cargo.lock`, `requirements.txt`) ‚Üí `docker compose build <service>`
* –ú–µ–Ω—è—é –±–∞–∑–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É/openssl/etc ‚Üí rebuild —Å `--no-cache` —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —è –º–æ–≥—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ö–µ–º—É —Ñ–∞–π–ª–æ–≤ –ø–æ–¥ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

* `docker-compose.base.yml` (mongo/redis/qdrant/vault + —Å–µ—Ç–∏/volumes)
* `docker-compose.dev.yml` (mounts + watch + –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã)
* `docker-compose.prod.yml` (nginx/certbot + –∑–∞–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã + –±–µ–∑ mounts)

‚Ä¶–∏ –ø—Ä–∏–º–µ—Ä Makefile-—Ç–∞—Ä–≥–µ—Ç–æ–≤ –ø–æ–¥ **–±—ã—Å—Ç—Ä—ã–π —Ü–∏–∫–ª** –∏ **—É–±–æ—Ä–∫—É –º—É—Å–æ—Ä–∞**.
