# A8 — Стратегия тестирования и CI/CD

## Контекст
Документы `requirements/тестирование/стек тестов.md` и `тестирование/испытание системы.md` задают тестовую пирамиду, окружения и критерии приёмки. Кроме того, TL-5 описывает процессы CI/CD. Цель задачи — внедрить автоматизированную стратегию тестирования и релизный конвейер, который гарантирует выполнение испытаний SYS-01…SYS-12 и edge-case сценариев.

## Состав работ
1. **Матрица тестов.**
   - Сопоставить сценарии SYS-01…SYS-12 и edge cases 8.1–8.7 с уровнями тестов (unit, integration, E2E, performance, security).
   - Создать `docs/test-matrix.md` с ответственными и ссылками на тестовые наборы.
2. **Тестовые данные.**
   - Подготовить каталоги `datasets/` с seed-пользователями (`student1`, `teacher1`, `admin1`), темами `orthography`, `syntax`, шаблонами и отчётами.
   - Скрипты генерации фиктивных данных (Mongo/Redis/Qdrant) для dev/test/staging.
6. **Автотесты.**
   - Unit: Vitest (frontend), `cargo test` (Rust), `pytest` (Python), покрытие ≥80 % критической логики.
   - Integration: docker-compose profile `test` (Mongo, Redis, Qdrant, Rust, Python) + Playwright API/E2E.
   - Contract: OpenAPI diff, JSON Schema, mock YandexGPT (либо Yandex Foundation Models API в тестовом режиме).
   - Performance: k6/vegeta сценарии (500 rps ответы, 50 rps подсказки), отчет в CI.
   - Security: fuzzing (`cargo-fuzz`), ZAP CLI, dependency audits.
4. **CI/CD пайплайны.**
   - CI/CD система (GitLab CI / Yandex Cloud CI): `lint-and-test` (unit + lint), `integration` (docker-compose + API/E2E), `build` (Docker images + PWA bundle), `release` (regression suite + публикация артефактов).
   - Кэширование зависимостей, артефакты (JUnit, coverage) хранить 30 дней.
   - Автоматическая генерация релизных заметок и деплой на staging/production (docker-compose/systemd).
5. **Gatekeeping и отчётность.**
   - Блокировать merge/deploy при падении критических тестов или отсутствии SLA метрик.
   - Формировать `test-report-{build}.md` на основании прогонов, подписывать заказчиком.
   - Настроить оповещения, если ветка `main` «красная» >24 часов.
6. **Документация и обучение.**
   - Обновить `docs/qa-strategy.md`, `docs/dev-setup.md` (запуск тестов локально), `docs/release.md`.
   - Провести воркшоп для команды (как писать тесты, работать с CI/CD, анализировать отчёты).

## Ожидаемые артефакты
- Полный набор автотестов, datasets и инструкций.
- CI/CD workflows (GitLab CI / Yandex Cloud CI), скрипты docker-compose/test, отчёты.
- Документация по тестовой стратегии и релизам.

## Чек-лист готовности
- [ ] Матрица тестов покрывает все сценарии требований и edge cases, ответственные назначены.
- [ ] В репозитории есть стабильные тестовые данные и скрипты их развертывания.
- [ ] Все уровни пирамиды имеют автотесты, прогоняемые в CI, и покрытие критических путей ≥80 %.
- [ ] CI/CD система блокирует merge/deploy при ошибках, артефакты сохраняются ≥30 дней.
- [ ] Отчёт об испытаниях (Test Plan & Report) формируется автоматически и согласуется заказчиком.
- [ ] Документация по тестам/CI актуальна, команда прошла обучение.

## Тестирование
- **Meta:** прогон всех workflow в CI/CD системе, проверка статусов, артефактов и уведомлений.
- **Data:** запуск скриптов генерации данных, проверка идемпотентности и соответствия требованиям (PII, шифрование).
- **E2E/Regression:** Playwright suite (SYS-01…SYS-12, офлайн, fallback) на staging перед релизом.
- **Perf/Security:** k6/vegeta, ZAP, `cargo audit`, `npm audit`, `pip-audit` интегрированы в CI.
- **Acceptance:** по плану «Испытание системы» — подтверждаем входные критерии (зелёные тесты, данные, релиз-кандидат) и фиксируем выходные (отчёт подписан).
