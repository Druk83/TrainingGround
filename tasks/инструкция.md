# Пошаговая инструкция: Создание задания для ученика

Эта инструкция описывает процесс создания задания от начала до конца через админ-панель контента.

## Важно: Порядок создания контента

**UI вкладки** (в админ-панели):
1. Шаблоны (первая вкладка)
2. Темы и уровни (вторая вкладка)
3. Правила (третья вкладка)

**Логический порядок создания** (который нужно соблюдать):
1. **Тема** → (обязательное основание для уровней)
2. **Уровень** → (обязательное основание для шаблонов)
3. **Правило** → (описание лингвистического правила)
4. **Шаблон** → (связывает уровень + правила + вопрос)

Даже если вкладка "Шаблоны" первая в UI, **сначала создавайте тему и уровень**, так как шаблон не может существовать без них.

---

## Шаг 1: Создайте тему

1. Перейдите на вкладку **"Темы и уровни"**
2. Заполните форму создания темы:
   - **SLUG**: `orthography` (только латиница, строчные буквы, дефисы)
   - **НАЗВАНИЕ**: `Орфография`
   - **ОПИСАНИЕ**: `Правописание слов: безударные гласные, согласные в корне, приставки, суффиксы`
3. Нажмите кнопку **"Создать тему"**
4. Убедитесь, что тема появилась в списке

---

## Шаг 2: Создайте уровень

1. Найдите созданную тему **"Орфография"** в списке
2. Нажмите кнопку **"Уровни"** (чтобы раскрыть секцию с уровнями)
3. Заполните форму создания уровня:
   - **Название уровня**: `Безударные гласные в корне`
   - **Сложность**: `A1`
   - **Минимум %**: `75`
4. Нажмите кнопку **"Добавить уровень"**
5. Снова нажмите **"Уровни"** чтобы убедиться, что уровень создан

---

## Шаг 3: Создайте правило

1. Перейдите на вкладку **"Правила"**
2. Найдите форму создания правила в верхней части страницы
3. Заполните данные правила:
   - **Slug**: `vowel-o-a` (уникальный идентификатор, только латиница и дефисы)
   - **Название**: `Безударная гласная О-А в корне`
   - **Категория**: `Орфография`
   - **Описание**:
     ```
     Проверяемые безударные гласные О и А в корне слова проверяются ударением.

     **Примеры:**
     - вода → воды
     - зола → золы
     ```
4. Нажмите **"Создать правило"**
5. Убедитесь, что правило появилось в списке карточек ниже

---

## Шаг 4: Создайте шаблон задания

### Типы заданий (ТИП ЗАДАНИЯ):
- **MCQ** (Multiple Choice Question) - Вопрос с вариантами ответа (выбор из нескольких)
- **Text Input** - Задание с текстовым вводом (ученик вводит ответ)
- **True / False** - Задание "Верно/Неверно" (два варианта ответа)

1. Вернитесь на вкладку **"Шаблоны"**
2. Нажмите кнопку **"Создать шаблон"**
3. Заполните форму шаблона:

   **Обязательные поля (сетка из 4 колонок):**
   
   - **SLUG**: `vowel-test-1` (уникальный идентификатор шаблона, только латиница, цифры и дефисы)
   
   - **Уровень (ObjectId)**: 
     - Скопируйте ID уровня из вкладки "Темы и уровни"
     - Пример: `6959372644932a8fab0a8715`
     - Это текстовое поле - вводите просто ID
   
   - **Сложность**: Выберите из выпадающего списка
     - Вариант 1: `Не указано` (пусто)
     - Вариант 2: `A1` (начальный уровень)
     - Вариант 3: `A2`
     - Вариант 4: `B1`
     - Вариант 5: `B2`
   
   - **Тип задания**: Выберите из выпадающего списка
     - Вариант 1: `Выберите` (не выбрано)
     - Вариант 2: `MCQ` (вопрос с вариантами ответа)
     - Вариант 3: `Text Input` (текстовый ввод)
     - Вариант 4: `True / False` (верно/неверно)

   **Текст задания (полная ширина):**
   - **ТЕКСТ ЗАДАНИЯ**:
     ```
     Вставьте пропущенную букву: в_да
     ```

   **Ответы (сетка из 2 колонок):**
   
   - **ПРАВИЛЬНЫЙ ОТВЕТ**: 
     - `о` (просто один символ или слово, в зависимости от типа)
   
   - **ВАРИАНТЫ (по одному в строке)** - появляется только если выбран тип `MCQ`:
     ```
     а
     о
     ```
     (Каждый вариант на новой строке)

   **Правила и источники (сетка из 2 колонок):**
   
   - **ПРАВИЛА (ObjectId, одна строка)**:
     - Скопируйте ID правила из вкладки "Правила"
     - Пример: `6959f041341e6ee2bba05071`
     - Это текстовое поле - вводите просто ID
     - Можно указать несколько правил (по одному на строку):
       ```
       6959f041341e6ee2bba05071
       6959f041341e6ee2bba05072
       6959f041341e6ee2bba05073
       ```
   
   - **ИСТОЧНИКИ (по одной ссылке)** - опционально:
     ```
     https://gramota.ru/
     https://rusyaz.ru/
     ```

   **Шаблоны подсказок и объяснений (сетка из 2 колонок):**
   
   - **ШАБЛОН ПОДСКАЗКИ** - опционально:
     - `{word:noun:genitive}` (пример шаблона)
     - или оставьте пусто
   
   - **ШАБЛОН ОБЪЯСНЕНИЯ** - опционально:
     - `{word:noun:genitive}` (пример шаблона)
     - или оставьте пусто

   **PII флаги (в конце формы):**
   - Снимите все галочки (EMAIL, PHONE, NAME)
     - ☐ EMAIL
     - ☐ PHONE
     - ☐ NAME

4. Нажмите **"Создать шаблон"**

---

## Шаг 5: Отправьте шаблон на модерацию

1. Найдите созданный шаблон в списке на вкладке **"Шаблоны"**
2. Проверьте, что шаблон находится в статусе `draft`
3. Нажмите кнопку **"Отправить на модерацию"**
4. Дождитесь уведомления об успешной отправке и убедитесь, что статус сменился на `pending_review`

> ⚠️ Если кнопка неактивна — обновите страницу. После отправки шаблон временно исчезает из фильтра "draft". Снимите фильтры или выберите статус `pending_review`, чтобы увидеть шаблон снова.

---

## Шаг 6: Одобрение и публикация

1. Нажмите кнопку **"Approve"**:
   - Первый клик переведёт шаблон из `pending_review` в `reviewed_once`
   - Второй клик (можно тем же пользователем) переведёт `reviewed_once` → `ready`
2. После статуса `ready` кнопка **"Publish"** станет активной. Нажмите её, чтобы сменить статус на `published`
3. Убедитесь, что карточка шаблона показывает статус `published`

> ⌛ Публиковать шаблон, минуя шаги `pending_review → reviewed_once → ready`, нельзя — Publish разблокируется только после двух последовательных одобрений.

---

## Шаг 7: Протестируйте задание как ученик

1. **Выйдите** из админ-панели (или откройте режим инкогнито)
2. **Войдите** как обычный пользователь (роль: student)
   - Email: `student@test.com`
   - Пароль: `password`
3. Перейдите в раздел **обучения** на главной странице
4. Выберите тему **"Орфография"**
5. Выберите уровень **"Безударные гласные в корне"**
6. Начните выполнение задания

**Проверьте:**
- ✅ Отображается ли вопрос корректно: "Вставьте пропущенную букву: в_да"
- ✅ Показываются ли варианты ответов: "а", "о"
- ✅ Принимается ли правильный ответ "о"
- ✅ Отклоняется ли неправильный ответ "а"
- ✅ Показывается ли правильная обратная связь после ответа
- ✅ Обновляется ли прогресс ученика

---

## Альтернативный простой пример

Если нужно самое простое задание для быстрого теста:

**Тема**: `test` (название: "Тест")
**Уровень**: `Проверка` (A1, минимум 70%)
**Правило**:
- Название: `Тестовое правило`
- Категория: `Математика`
- Описание: `Простое сложение чисел`

**Шаблон**:
```
Текст: "Сколько будет 2+2?"
Параметры: {"answer": "4"}
```

---

## Примечания

### Slug полей
- **SLUG** темы, правила и шаблона должен содержать только **строчные латинские буквы**, цифры и дефисы
- Slug должен быть уникальным в пределах своей коллекции
- Примеры: `orthography`, `vowel-test-1`, `genitive-vowel`

### Заполнение полей с MultiLine значениями
- Поля **"ВАРИАНТЫ (по одному в строке)"**, **"ПРАВИЛА"**, **"ИСТОЧНИКИ"** позволяют вводить **по одному значению на строке**
- Новая строка = новый элемент в списке
- Пример для ПРАВИЛ:
  ```
  659f041341e6ee2bba05071
  659f041341e6ee2bba05072
  659f041341e6ee2bba05073
  ```
- Каждое значение будет обработано как отдельный элемент массива

### Markdown
- Поле **Описание** правила поддерживает Markdown-разметку (списки, жирный текст, ссылки)

### Порядок заполнения формы шаблона
Заполняйте форму **сверху вниз**:
1. **Slug** - уникальный идентификатор
2. **Уровень (ObjectId)** - выбранный уровень
3. **Сложность** - уровень сложности (опционально)
4. **Тип задания** - MCQ, Text Input или True/False
5. **Текст задания** - само задание для ученика
6. **Правильный ответ** - ожидаемый правильный ответ
7. **Варианты** (только для MCQ) - список вариантов ответа
8. **Правила** - ObjectId одного или нескольких применимых правил
9. **Источники** - ссылки на источники (опционально)
10. **Шаблон подсказки** - шаблон для подсказки (опционально)
11. **Шаблон объяснения** - шаблон для объяснения (опционально)
12. **PII флаги** - снимите все галочки
13. Нажмите кнопку **"Создать шаблон"**

### Получение ObjectID
**Как скопировать ID уровня:**
1. Перейдите на вкладку "Темы и уровни"
2. Нажмите кнопку "Уровни" у нужной темы
3. В раскрывшемся списке уровней найдите нужный уровень
4. **ID отображается в левом верхнем углу карточки уровня** в формате 24-символьной строки (например: `6959372644932a8fab0a8715`)
5. Скопируйте этот ID (Ctrl+C / Cmd+C)
6. Вставьте в поле **"Уровень (ObjectId)"** формы создания шаблона

**Как скопировать ID правила:**
1. Перейдите на вкладку "Правила"
2. В списке правил (карточек) найдите нужное правило
3. **ID отображается в левом верхнем углу карточки правила** в формате 24-символьной строки (например: `6959f041341e6ee2bba05071`)
4. Скопируйте этот ID (Ctrl+C / Cmd+C)
5. Вставьте в поле **"ПРАВИЛА (ObjectId, одна строка)"** формы создания шаблона
6. Если нужно несколько правил - вставьте их **по одному на строке**:
   ```
   6959f041341e6ee2bba05071
   6959f041341e6ee2bba05072
   6959f041341e6ee2bba05073
   ```

### Удаление данных
- Для удаления тем и уровней используйте кнопки "Удалить" в админ-панели
- Удаление темы автоматически удаляет все ее уровни
- Будьте осторожны: удаление необратимо

### Тестирование
- Обязательно тестируйте задания перед публикацией для реальных учеников
- Проверяйте правильность ответов и корректность отображения текста
