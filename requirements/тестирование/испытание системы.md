# План испытаний системы

Документ определяет процедуры системных и приёмочных испытаний проекта «Русский язык: тренировочный полигон». Основан на требованиях (AL/BL/TL) и тестовой стратегии.

---

## 1. Цель и охват

- Подтвердить, что MVP удовлетворяет бизнес-сценариям: прохождение урока, выдача подсказок, аналитика, модерация, античит.  
- Проверить SLA (latency, подсказки, отчёты) и деградации (fallback Qdrant, недоступность YandexGPT).  
- Провести приёмку с участием методистов/кураторов.

---

## 2. Участники и роли

| Роль | Ответственность |
|------|-----------------|
| QA-инженер | Планирование, выполнение тесткейсов, отчёт о дефектах. |
| Методист (Product Owner) | Приёмка контента, проверка правил. |
| Представитель заказчика (куратор) | Проверка аналитики, отчётов. |
| DevOps/разработчик | Подготовка окружения, поддержка при сбоях. |

---

## 3. Окружение

- **Test**: docker-compose (MongoDB 6, Redis 7, Qdrant 1.8, Rust API, Python сервис, PWA).  
- **Staging**: аналог прод-окружения, подключённое к данным (анонимизированные).  
- Данные: seed-пользователи (`student1`, `student2`, `teacher1`, `admin1`), темы `orthography`, `syntax`.  
- Мониторинг: Prometheus/Grafana (опционально) для фиксации SLA.

---

## 4. Входные критерии

- Все unit/integration тесты зелёные (см. «Стек тестов»).  
- Сформированы тестовые данные и роли (JWT/SSO).  
- Опубликованы инструкции по использованию (dev-setup).  
- Утверждён релиз-кандидат (Docker images, PWA bundle).

## 5. Выходные критерии

- Выполнены все тест-кейсы (pass/ fail); критические дефекты закрыты или согласованы workaround'ы.  
- SLA подтверждены (latency, подсказки, отчёты).  
- Сформирован отчёт об испытаниях и подписан заказчиком.

---

## 6. Сценарии испытаний

| ID | Сценарий | Шаги/ожидания | Результат |
|----|----------|---------------|-----------|
| SYS-01 | Прохождение урока без подсказок | Student1 проходит уровень (5–20 заданий) → ≥80 % правильных → открывается следующий уровень, статистика обновляется. | Баллы начислены по правилам, данные в `progress_summary`. |
| SYS-02 | Прохождение с подсказками | Student2 использует 2 подсказки, проверяем штрафы и лимит. | −5 за подсказку, подсказки блокируются после 2-х запросов. |
| SYS-03 | Серии и бонусы | Набрать ≥3 правильных подряд → ожидать +5 бонуса, сброс при ошибке. | `score:series` работает, `Attempt Record` фиксирует бонус. |
| SYS-04 | Таймер/таймаут | Превысить 2 минуты по одному заданию. | Ответ помечен неверным, серия сброшена. |
| SYS-05 | Выдача подсказки из кэша | Повторный запрос того же задания. | Ответ ≤500 мс, данные из Redis. |
| SYS-06 | Новая генерация подсказки | Тема без кэша → Python сервис, Qdrant, YandexGPT. | Ответ ≤3 сек, есть ссылку на правило. |
| SYS-07 | Отказ Qdrant | Отключить Qdrant, запросить подсказку. | Возвращается шаблон из Mongo, лог предупреждения. |
| SYS-08 | Аналитика куратора | Teacher1 смотрит отчёт класса и делает экспорт. | Таблица загружается ≤10 сек, CSV доступна. |
| SYS-09 | Модерация контента | Admin добавляет шаблон, публикует и проверяет, что Session Manager видит новый материал. | Эмбеддинги созданы, статус `published`. |
| SYS-10 | Античит | Сымитировать 6 быстрых ответов (<2 сек) + повторяющиеся шаблоны. | В `incidents` появляется запись; `anticheat:{user}` → блокировка 24 ч. |
| SYS-11 | Авторизация/роли | Учитель не может видеть чужие группы, админ имеет полный доступ. | RLS работает; запрос чужой группы → 403. |
| SYS-12 | Офлайн-режим | Отключить сеть после загрузки урока. | PWA продолжает работу с кешом, при возобновлении отправляет результаты. |

Дополнительные сценарии добавляются по мере готовности (SSO, мониторинг, SLO alerts).

---

## 7. Нефункциональные испытания

- **Performance:** нагрузка 500 rps (уроки без подсказок), 50 rps (подсказки), 10 параллельных генераций → latency соблюдается.  
- **Recovery:** перезапуск Redis, Mongo, Qdrant, проверка восстановления.  
- **Security:** проверка JWT, CSRF, HTTPS, OAuth (если включен), попытка обхода подсказок (некорректные запросы).  
- **Backup/Restore:** восстановление из Mongo dump + Qdrant snapshot.

---

## 8. Отчётность

- QA формирует `test-report-{build}.md` (описание прохождения, найденные дефекты, метрики SLA).  
- Все дефекты фиксируются в issue tracker (`issues/TEST-xxx`).  
- Приёмка проводится на совещании с заказчиком; принятие оформляется протоколом или подписью в отчёте.

Документ актуализируется при изменении функциональности или SLA.
