# Порты и сетевые соединения

Документ фиксирует сетевые порты для всех сервисов проекта «Русский язык: тренировочный полигон». Порты разделены на обязательные (используются везде) и опциональные (например, мониторинговые инструменты, которые могут быть выключены в MVP). Все значения повторяются в `infra/networking/ports.yaml`.

---

## 1. Фронтенд / Ingress

| Сервис | Порт (наружный) | Примечания |
|--------|-----------------|------------|
| HTTPS (PWA) | 443 | Основной доступ к Rust API и статикам PWA. |
| HTTP (dev) | 8080 | Только локальная разработка (esbuild dev-server). |

---

## 2. Приложения и сервисы

| Компонент | Порт | Назначение | Примечания |
|-----------|------|------------|------------|
| Rust API (внутренний) | 8081 | REST/SSE/WebSocket | За Ingress, только внутренняя сеть. |
| Python Generator / Explanation API | 9000 | REST/gRPC | Только внутренняя сеть; таймаут 2 сек. |
| MongoDB Replica Set | 27017 | Документное хранилище | Обязательный порт. |
| Redis Cluster | 6379 | Кэш, очереди | Обязательный. |
| Qdrant | 6333 | Векторный индекс | Обязательный. |
| Object Storage (S3) | 9001 (пример) | Бэкапы и PWA | Конкретный порт зависит от провайдера. |
| CI/CD Runner SSH | 22 | Доступ к серверам | Ограничен IP белым списком. |

---

## 3. Мониторинг и опциональные сервисы

| Сервис | Порт | Статус |
|--------|------|--------|
| Prometheus | 9090 | опция |
| Grafana | 3000 | опция |
| Alertmanager | 9093 | опция |
| Loki / Fluent Bit | 3100 / 24224 | опция |

---

## 4. Внешние интеграции / провайдеры

| Сервис | Протокол / Порт | Примечания |
|--------|-----------------|------------|
| YandexGPT API | HTTPS 443 | Внешний REST, доступ через egress. |
| OAuth2 / SAML провайдеры | HTTPS 443 | Интеграция со школами (опция). |
| SMTP | 587 / 465 | Отправка писем. |
| Telegram Bot API | HTTPS 443 | Уведомления (опция). |

---

## 5. Политики

- Все внутренние порты (8081, 9000, 27017, 6379, 6333) доступны только в приватной сети/Service Mesh (mTLS).  
- Межсетевые взаимодействия описаны в `infra/networking/security-groups.tf`.  
- Мониторинговые порты (Prometheus, Grafana, Loki) по умолчанию закрыты извне и помечены как опциональные: включаются только при наличии выделенной инфраструктуры.  
- Для разработки портовые конфликты описаны в `docs/dev-setup.md`.
