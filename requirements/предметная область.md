
# Предметная область

## 1. Назначение документа
Определяет контекст и границы образовательного продукта «Русский язык: тренировочный полигон». Описывает бизнес-цели, заинтересованные стороны, учебные процессы, объекты данных и ограничения, чтобы дальнейшие требования (архитектура, сценарии, тесты) базировались на согласованной модели предметной области.

## 2. Контекст и цели
- **Основа продукта.** Игровой тренажёр, который помогает школьникам 8–11 классов и взрослым повторять грамматику, орфографию и пунктуацию русского языка через короткие сессии.
- **Учебная цель.** Систематическая отработка тем «от простого к сложному» с фиксированной последовательностью правил и обязательной обратной связью.
- **Игровая цель.** Поддерживать мотивацию через таймеры, баллы, бонусы за серии правильных ответов, рейтинги и достижения.
- **Платформы к развитию.** Веб-приложение (MVP), далее PWA и терминальная версия; единая серверная логика и общий банк заданий.

## 3. Заинтересованные стороны и роли
- **Игрок (ученик).** Использует веб-интерфейс или мобильную версию, выбирает тему, решает задания, отслеживает прогресс и повторно проходит уровни.
- **Учитель/куратор.** Анализирует статистику групп, рекомендует темы, проверяет проблемные места и может формировать подборки заданий.
- **Администратор контента.** Настраивает темы, добавляет/редактирует шаблоны заданий и правила подсказок, следит за качеством данных.
- **ИИ-модуль (YandexGPT).** Генерирует задания/варианты, формирует пояснения, помогает адаптировать сложность.
- **Система античита.** Техническая роль: мониторит попытки автоматизированного ввода и нарушения правил.

## 4. Основные процессы
1. **Выбор темы или курса.** Пользователь получает каталог тем, сгруппированных по разделам русского языка, либо запускает линейный курс.
2. **Формирование набора заданий.**
   - Система выбирает 5–20 заданий по выбранной теме с учётом истории игрока.
   - Шаблоны заполняются параметрами (слова, предложения, пропуски) и проверяются на уникальность в рамках текущего уровня.
   - При необходимости вызывается YandexGPT для генерации текста или пояснений.
3. **Прохождение уровня.**
   - На каждое задание выделяется 2 минуты; по истечении таймера ответ не засчитывается.
   - Подсказки (до двух) уменьшают балл за попытку.
   - Система мгновенно сверяет ответ, добавляет +10 баллов за верный и 0 за неверный, выводит правило.
4. **Начисление бонусов и переход уровней.**
   - Серия ≥3 правильных ответов даёт +5 баллов за каждый последующий верный ответ.
   - Для перехода на следующий уровень требуется ≥80 % правильных ответов.
5. **Повторное прохождение.** Пользователь может повторять уровень для улучшения результата; хранится последняя статистика и лучшая попытка.
6. **Аналитика и отчётность.** Система формирует отчёты по темам, времени, проценту верных ответов; кураторы используют данные для рекомендаций.

## 5. Типы заданий и требования к контенту
- **Множественный выбор.** Варианты ответов, генерация дистракторов, чёткая привязка к правилу.
- **Короткий ввод текста.** Проверка слов/знаков препинания, поддержка нескольких правильных вариантов.
- **Сопоставление элементов.** Например, сочетание правил и примеров или расстановка слов по категориям.
- **Анализ текста.** Определение главных членов предложения, типов связи, пунктуационных конструкций.
- **Пояснения.** Каждое задание содержит ссылку на правило и текст объяснения, чтобы закрыть пробелы знаний.
- **Шаблоны и вариативность.** Для каждой темы готовится набор шаблонов с параметрами; ИИ используется для подстановки примеров и адаптации сложности без потери качества.

## 6. Информационные объекты
- **Тема**: название, описание, уровень сложности, список правил.
- **Уровень**: связка темы, набора заданий и критериев прохождения (80 % правильных ответов, лимит подсказок).
- **Задание (шаблон + экземпляр)**: тип, текст с плейсхолдерами, параметры генерации, правильные ответы, объяснение, стоимость подсказки.
- **Подсказка**: вид подсказки (правило, пример, исключения) и штраф по баллам.
- **Игрок**: профиль, прогресс по темам, история попыток, достижения.
- **Попытка**: временная метка, количество подсказок, результат, затраченное время на каждое задание.
- **Античит-событие**: сигнатуры подозрительных действий (скрипты ввода, сверхбыстрые ответы), связанные решения (блокировка, предупреждение).

## 7. Организация базы знаний и работа ИИ
- **Документное ядро.** Все правила, шаблоны заданий, примеры и методические комментарии хранятся в документно-ориентированной БД (MongoDB). Каждый документ содержит ссылку на тему, тип задания, текст правила, пример и набор атрибутов (сложность, теги, версия).
- **Векторное представление.** Для каждого документа и его фрагментов Python-сервис рассчитывает эмбеддинги (через YandexGPT/встроенную модель) и сохраняет их в Qdrant. Векторное хранилище включает идентификатор документа, эмбеддинг, метаданные (тема, уровень, теги, дата).
- **Связь уровней.** Документное ядро является источником истины; при изменении записи автоматически пересоздаются эмбеддинги, чтобы векторная база оставалась консистентной.
- **Использование ИИ.** При генерации задания или пояснения Python-сервис выполняет Retrieval-Augmented Generation: по запросу (тема, уровень, вид ошибки) извлекаются k ближайших фрагментов из векторной базы, формируется подсказка/контекст и передаётся в YandexGPT для генерации варианта. При недоступности вектора используется прямой доступ к шаблонам из MongoDB.
- **Выдача пользователю.** Игровой API всегда опирается на зафиксированный экземпляр задания из MongoDB, чтобы обеспечить повторяемость. Векторные результаты используются только на этапе генерации и пояснений.
- **Версионность.** Каждое изменение правила или шаблона помечается версией; история хранится в MongoDB, а устаревшие эмбеддинги удаляются из индекса после публикации новой версии.

## 8. Ограничения и бизнес-правила
- Нельзя использовать автоматический ввод ответов; система фиксирует ускоренные ответы и дублирование.
- Задания не должны повторяться внутри одной попытки и должны покрывать все подтемы курса.
- При превышении таймера задание автоматически считается неверным.
- Подсказки покупаются ценой 5 баллов; отрицательного баланса быть не должно.
- Баллы не суммируются между повторными прохождениями; статистика обновляется на основе последней попытки и лучшего результата.
- ИИ-генерация должна иметь fallback на ручной банк заданий при недоступности API.
- Все интерфейсы, формулировки и пояснения должны соответствовать нормам русского языка и целевой аудитории (ученики школ).

## 9. Метрики успеха
- Средний процент правильных ответов после 3 попыток на тему ≥85 %.
- Уменьшение количества ошибок по отслеживаемым правилам между попытками (рост навыков).
- Среднее время генерации сессии ≤3 секунды, обработка ответа ≤1 секунды.
- Пользовательский NPS/оценка удовлетворённости ≥8/10 после прохождения уровня.
- Не более 1 % попыток блокируются системой античита (ложные срабатывания).

## 10. Риски предметной области
- **Однообразные задания** → падение мотивации; требуется достаточный банк шаблонов и вариативность через ИИ.
- **Несбалансированная сложность** → слишком высокий порог прохождения; необходимо адаптивное ранжирование тем и подсказок.
- **Ошибки в автоматической проверке** → снижение доверия к системе; важно подтверждать правила экспертами и валидировать ИИ.
- **Задержки ИИ-сервиса** → ухудшение UX; нужна стратегия кэширования и офлайн-шаблонов.
- **Несоответствие школьной программе** → непринятие учителями; необходимо согласование с ФГОС и типовыми учебными планами.

Документ служит отправной точкой для разработки архитектуры, сценариев и тестов и должен обновляться по мере уточнения требований стейкхолдеров.
